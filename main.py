import socket
import requests
import ssl
import re

from lxml import etree

class bruteforcepage():
    def __init__(self,url,xpathDic,herder:dict):
        self.url = url
        self.xpathDic = xpathDic
        self.header = herder
        self.field=[]
        # self.proxy= proxy
        # self.xpath = ""
        self.item = []

    def from_xpathDic_get_xpath(self):
        temp1=[]
        temp2=[]
        #传入的是一个字典
        self.field =list(self.xpathDic.keys())
        self.xpathDic = list(self.xpathDic.values())
        print(self.xpathDic)
        print(self.field)

        for i in self.xpathDic:
            j=0
            preg = "]-["
            # 传入的是一个串,如果有"]-[",则形成相应的xpath
            if preg in i:
                a = "//div[@class='list_list']//li[1]-[10]/div/a/@href"
                preg2 = "\[([0-9].?)\]"
                over = re.findall(preg2, a)
                first = over[0]
                secound = over[1]
                for i in range(int(first), int(secound) + 1):
                    t = a.replace(str(first) + str(preg) + str(secound), str(i))
                    temp2.append(t)
            else:
                temp2.append(i)
            temp1.append(temp2)
        print(temp1)

    def set_proxy(self):
        pass

    def get_page_info(self):
        #定义对象
        session = requests.Session()
        #通过session获取content
        req = session.get(self.url, headers=self.header)

        req.encoding = 'utf8'
        #将content转为Element
        Ele = etree.HTML(req.content)
        #通过Xpath获取对象---想要设置值的对象
        # print(self.xpathDic)
        for i in range(len(self.xpathDic)):
            self.item.append(Ele.xpath(self.xpathDic[i]))

        print(self.item[1])
    #def set_cookie_useragent()

    #def read_user_file()

    #def read_pass_file()

    #def set_user_pass()

    #def get_answer()

    #def get_result()

    #def thread()

    def run(self):
        self.from_xpathDic_get_xpath()
        # self.get_page_info()

if __name__ == '__main__':

    #国家信息安全
    i = 1
    url = f"http://www.cnnvd.org.cn/web/vulnerability/querylist.tag?pageno={i}&repairLd="


    # # url = "https://id.163yun.com/login?h=media&t=media&clueFrom=nim&from=bdjj2006y12487&referrer=https%3A%2F%2Fapp.yunxin.163.com%2F%3Ffrom%3Dbdjj2006y12487&i18nEnable=true"
    header = {
        "user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0"
    }
    # xpathDic = {
    #     "username" :'//input[@class="m-input m-input-large account-input"]',
    #     "password" :'//input[@class="m-input m-input-large password-input"]',
    # }
    #支持x-y写法
    xpathDic = {
        "url" : '//div[@class="list_list"]//li[1]-[10]//a/@href',
        "title" : "//div[@class='list_list']//li[1]-[10]/div/a/text()",
        "number" : "//div[@class='list_list']//li[1]/div/p//a/text()",
        }
    proxy = {"http": "socks5://202.91.35.158:443", "https": "socks5://202.91.35.158:443"}
    begin = bruteforcepage(url,xpathDic,header)
    begin.run()
